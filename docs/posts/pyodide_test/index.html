<!DOCTYPE html>
<html lang="en-us">
  <head><link rel="icon" href="../../images/chicken.png"><meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<meta http-equiv="x-ua-compatible" content="ie=edge" /><meta property="og:url"  content="/posts/pyodide_test/" />
    <meta property="og:type" content="article" /><meta property="og:title" content="Pyodide test" /><meta property="og:description" content="" /><meta property="og:image:width"  content="375" />
        <meta property="og:image:height" content="250" /><meta property="og:image" content="/images/default_summary_hu2be732aee21a2469ead3fe1f2df8caca_2088687_600x0_resize_q75_box.jpg" /><title>Clark Zhang - Pyodide test</title>

    
<link href="https://fonts.googleapis.com/css?family=Open&#43;Sans" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Open&#43;Sans" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Open&#43;Sans" rel="stylesheet"><link rel="stylesheet" type="text/css" href="../../css/style.min.fd8404bc9563664fb2e4d7e8277f357361b1f697aface37acfe6ec5e83fa02e0.css" integrity="sha256-/YQEvJVjZk&#43;y5NfoJ381c2Gx9pevrON6z&#43;bsXoP6AuA=">
<link rel="stylesheet" type="text/css" href="../../css/monokai-sublime.9.15.8.min.min.3a5d282f03108101d715e80fd4c07b55502ec4673fc063f2b6e415d4def5b354.css" integrity="sha256-Ol0oLwMQgQHXFegP1MB7VVAuxGc/wGPytuQV1N71s1Q=">
<link rel="stylesheet" type="text/css" href="../../css/icons.min.6dc06ab2f3698408961127b959a0f87ba0426dfa1df4cb25a55fa434db7222c5.css" integrity="sha256-bcBqsvNphAiWESe5WaD4e6BCbfod9MslpV&#43;kNNtyIsU=">
<link rel="stylesheet" type="text/css" href="../../css/refresh.min.14cd467648af8c16a7b0d152412f3c595bf4210380516c0acc67c776fa1c0c60.css" integrity="sha256-FM1GdkivjBansNFSQS88WVv0IQOAUWwKzGfHdvocDGA=">
<link rel="stylesheet" type="text/css" href="../../css/devicon.min.min.13fddf418611477a10293a87542de7703396184696bd8cf50642c4c72994c78a.css" integrity="sha256-E/3fQYYRR3oQKTqHVC3ncDOWGEaWvYz1BkLExymUx4o=">
    

  </head>
  <body>
     

    <div id="preloader">
      <div id="status"></div>
    </div><nav class="navbar is-fresh is-transparent no-shadow" role="navigation" aria-label="main navigation">
  <div class="container">
    <div class="navbar-brand">

      
      
      
      <a class="navbar-item">
        <div class="menu-icon-wrapper left-menu-icon-wrapper" style="visibility: visible;">
          <svg width="1000px" height="1000px">
            <path class="path1" d="M 300 400 L 700 400 C 900 400 900 750 600 850 A 400 400 0 0 1 200 200 L 800 800"></path>
            <path class="path2" d="M 300 500 L 700 500"></path>
            <path class="path3" d="M 700 600 L 300 600 C 100 600 100 200 400 150 A 400 380 0 1 1 200 800 L 800 200"></path>
          </svg>
          <button id="menu-icon-trigger" class="menu-icon-trigger"></button>
        </div>
        <div class="navbar-item left-menu-icon-wrapper">
          Menu
        </div>
      </a>

      
    </div></div>
</nav>
<nav id="navbar-clone" class="navbar is-fresh is-transparent" role="navigation" aria-label="main navigation">
  <div class="container">
      <div class="navbar-brand">
  
        
        
        
        <a class="navbar-item">
          <div class="menu-icon-wrapper left-menu-icon-wrapper" style="visibility: visible;">
            <svg width="1000px" height="1000px">
              <path class="path1" d="M 300 400 L 700 400 C 900 400 900 750 600 850 A 400 400 0 0 1 200 200 L 800 800"></path>
              <path class="path2" d="M 300 500 L 700 500"></path>
              <path class="path3" d="M 700 600 L 300 600 C 100 600 100 200 400 150 A 400 380 0 1 1 200 800 L 800 200"></path>
            </svg>
            <button id="menu-icon-trigger" class="menu-icon-trigger"></button>
          </div>
          <div class="navbar-item left-menu-icon-wrapper">
            Menu
          </div>
        </a>
  
        
      </div>
  
      

    </div>
  </nav>
<section class="section is-medium">
  <div class="container">
    <div class="columns">
      <div class="column is-centered-tablet-portrait">
        <h1 class="title is-2 section-title">Pyodide test</h1>
        <h5 class="subtitle is-5 is-muted"></h5>
        <div class="divider"></div>
        
        <section class="section content has-text-justified">
          <p>Testing <a href="https://github.com/iodide-project/pyodide" target="_blank">pyodide</a>, the cpython interpreter compiled to webasm. Quick test of a 3 link robot arm.</p>

<script type="text/javascript">
    // set the pyodide files URL (packages.json, pyodide.asm.data etc)
    window.languagePluginUrl = 'https://cdn.jsdelivr.net/pyodide/v0.16.1/full/';
</script>
<script src="https://cdn.jsdelivr.net/pyodide/v0.16.1/full/pyodide.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"
integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" 
crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-python.min.js" integrity="sha512-2Ke4vMGrMfYRM55pT1aA5bw7Pl82Sc7K5Hg8XZYZu+EQrb0AO1mNYTagwZm+MFVAImYS9Mlnm73zcgc01wPXxA==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-monokai.min.js" integrity="sha512-S4i/WUGRs22+8rjUVu4kBjfNuBNp8GVsgcK2lbaFdws4q6TF3Nd00LxqnHhuxS9iVDfNcUh0h6OxFUMP5DBD+g==" crossorigin="anonymous"></script>

<link rel="stylesheet" href="style.css">

Type Python code here
<div id="editor">
# you can modify the arm lengths here and then press submit
arm.lengths = np.array([1., 1., 1.])
</div>
<br>

<br>
<input type="submit" value="Submit" id="button">
<br>
<textarea id="output" rows="4" cols="50">Loading</textarea>
<br>
<br>

<!-- <img id="arm-figure1"/> -->
<div id="arm-figure1"></div>
<div>
    <input type="range" id="arm-theta0"
           min="-3.14" max="3.14", step="0.1", value="1.5">
    <label for="arm-theta0">theta0</label>
</div>
<div>
    <input type="range" id="arm-theta1"
           min="-3.14" max="3.14", step="0.1", value="-0.5">
    <label for="arm-theta1">theta1</label>
</div>
<div>
    <input type="range" id="arm-theta2"
           min="-3.14" max="3.14", step="0.1", value="-0.5">
    <label for="arm-theta2">theta2</label>
</div>

<script type="text/javascript">
    var editor = ace.edit("editor");
    editor.getSession().setMode("ace/mode/python");
    editor.setTheme("ace/theme/monokai");

    setup_script = `import numpy as np
import matplotlib.pyplot as plt
from js import document
import io
import base64


class Arm(object):
    def __init__(self):
        self.lengths = np.array([1., 1., 1.])
        self.lines = None
        self.pts = None

    def fwd_kinematics(self, thetas):
        cum_thetas = np.cumsum(thetas)
        x_diffs = self.lengths * np.cos(cum_thetas)
        y_diffs = self.lengths * np.sin(cum_thetas)

        x_coords = np.cumsum(x_diffs)
        y_coords = np.cumsum(y_diffs)

        coords = np.stack((x_coords, y_coords), axis=1)
        coords = np.concatenate((np.array([[0., 0.]]), coords), axis=0)

        return coords


    def draw(self, ax, thetas):
        coords = self.fwd_kinematics(thetas)
        assert(len(coords) == 4)

        if self.lines is None:
            self.lines = []
            for i in range(3):
                self.lines.append(ax.plot([0, 1], [0, 1], c="b")[0])
            self.pts = ax.scatter([0, 0, 0, 0], [0, 0, 0, 0], c="g")

        for i in range(len(coords) - 1):
            pt1 = coords[i, :]
            pt2 = coords[i+1, :]
            self.lines[i].set_data([pt1[0], pt2[0]], [pt1[1], pt2[1]])
        self.pts.set_offsets(coords)
        
        ax.set_xlim([-4, 4])
        ax.set_ylim([-4, 4])
        ax.set_aspect('equal', 'box')

#ordinary function to find an existing div
#you'll need to put a div with appropriate id somewhere in the document
def create_root_element2(self):
    return document.getElementById('arm-figure1')

arm = Arm()
f = plt.figure()

print(dir(f.canvas))
#override create_root_element method of canvas by one of the functions above
f.canvas.create_root_element = create_root_element2.__get__(
    create_root_element2, f.canvas.__class__)

ax = f.gca()

ax.grid()

theta0 = float(document.getElementById("arm-theta0").value)
theta1 = float(document.getElementById("arm-theta1").value)
theta2 = float(document.getElementById("arm-theta2").value)
thetas = [theta0, theta1, theta2]
arm.draw(ax, thetas)

f.canvas.show()


#buf = io.BytesIO()
#plt.savefig(buf, format='png')
#buf.seek(0)
#img_str = "data:image/png;base64," + base64.b64encode(buf.read()).decode('UTF-8')

#img_tag = document.getElementById("arm-figure1")
#img_tag.src = img_str
#buf.close()`

    theta_change_script = `
theta0 = float(document.getElementById("arm-theta0").value)
theta1 = float(document.getElementById("arm-theta1").value)
theta2 = float(document.getElementById("arm-theta2").value)

thetas = [theta0, theta1, theta2]
arm.draw(ax, thetas)

f.canvas.show()
`

    function setup_slider_cbs() {
        $("#arm-theta0").on("change", ()=>{
            pyodide.runPythonAsync(theta_change_script)
                .then(()=>{})
                .catch(()=>{});
        });
        $("#arm-theta1").on("change", ()=>{
            pyodide.runPythonAsync(theta_change_script)
                .then(()=>{})
                .catch(()=>{});
        });
        $("#arm-theta2").on("change", ()=>{
            pyodide.runPythonAsync(theta_change_script)
                .then(()=>{})
                .catch(()=>{});
        });
    };

    languagePluginLoader.then(() => {
        pyodide.runPythonAsync(setup_script)
            .then( (output)=>{
                console.log(output);
                $("#output").val("Ready\n>>>");
                setup_slider_cbs();} )
            .catch( (err)=>{console.log(err);});
    });



    $("#button").click(function() {
        pyodide.runPythonAsync(editor.getValue() + "\n" + theta_change_script)
            .then(function(output) {$("#output").val($("#output").val() + "\n>>>" + String(output));})
            .catch(function(err) {$("#output").val($("#output").val() + "\n>>>" + String(err));});
        });
</script>






        </section>
      </div>
    </div>
  </div>  
  <div class="container">
    <div class="columns">
      <div class="column has-text-right is-family-monospace is-centered-tablet-portrait">
        Last modified:&nbsp;20 February 2021</div>
    </div>
  </div></section>
<footer class="footer footer-dark">
  <div class="container">
    <div class="columns">


      <div class="column">
        <div class="column">
          <div class="footer-column">
            <ul class="link-list">
              <li>
                Contact Information:
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div class="column">
        <div class="column">
          <div class="footer-column">
            <ul class="link-list">  
              
              <li>
                <a href="mailto:clarkjzhang%20%28at%29%20gmail.com" target="_blank">
                  <span class="icon"><i class="fa fa-envelope"></i></span>
                  
                    clarkjzhang (at) gmail.com
                  
                </a>
              </li>
              
            </ul>
          </div>
        </div>
      </div>

      <div class="column">
        <div class="column">
          <div class="footer-column">
            <ul class="link-list">
              
              <li>
                <a href="https://www.linkedin.com/in/clark-zhang-2207a774" target="_blank">
                  <span class="icon"><i class="fa fa-linkedin"></i></span>
                  
                    LinkedIn
                  
                </a>
              </li>
              
            </ul>
          </div>
        </div>
      </div>

    <div class="column">
      <div class="column">
        <div class="footer-column">
          <ul class="link-list">
            
            <li>
              <a href="https://github.com/chickensouple" target="_blank">
                <span class="icon"><i class="fa fa-github"></i></span>
                
                  Github
                
              </a>
            </li>
            
          </ul>
        </div>
      </div>
    </div>

    </div>
  </div>
</footer>
    <div id="backtotop"><a href="#"></a></div><div class="sidebar scroll">
  <div class="sidebar-header">
    
    <img src="../../images/chicken.png" alt="">
    <a class="sidebar-close" href="javascript:void(0);">
      <i data-feather="x"></i>
    </a>
    
  </div>
  <div class="inner">
    <ul class="sidebar-menu">
      <li class="no-children"><a href="../../"><div class="columns">
          <table width="100%">  
            <tr>
              <td class="">
                <span class="icon"><i class="fa fa-caret-right"></i></span>
                Home
              </td>
              <td class="has-text-right" >
                  
              </td>
            </tr>
          </table>
        </div>
      </a>
      </li>
      <li class="no-children"><a href="../../posts/"><div class="columns">
          <table width="100%">  
            <tr>
              <td class="">
                <span class="icon"><i class="fa fa-caret-right"></i></span>
                Posts
              </td>
              <td class="has-text-right" >
                  
              </td>
            </tr>
          </table>
        </div>
      </a>
      </li>
    </ul>
  </div>
</div>
<script src="../../js/jquery-2.2.4.min.9905f735619722ceaee707531dbce48d85dc03730eeec5377e640ad222fc7564.js" integrity="sha256-mQX3NWGXIs6u5wdTHbzkjYXcA3MO7sU3fmQK0iL8dWQ="></script>
  <script src="../../js/feather.4.22.0.min.60f99c81ecaf159163820d5a01c6a3341afc02fbb64a51d21b685c79a3130217.js" integrity="sha256-YPmcgeyvFZFjgg1aAcajNBr8Avu2SlHSG2hceaMTAhc="></script>
  <script src="../../js/modernizr-3.6.0.min.7d44f7a93c82d33b0fe07bdb55abc91922e5c7644a5977c358ab47cc54d5d08f.js" integrity="sha256-fUT3qTyC0zsP4HvbVavJGSLlx2RKWXfDWKtHzFTV0I8="></script>
  <script src="../../js/refresh.62c1a9b7d85bcf4d944cd585a01dfa8fb15112a7d2cf9fb819db20493bfe7484.js" integrity="sha256-YsGpt9hbz02UTNWFoB36j7FREqfSz5&#43;4GdsgSTv&#43;dIQ="></script></body>
</html>
